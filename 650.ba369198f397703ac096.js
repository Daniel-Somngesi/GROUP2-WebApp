(self.webpackChunkeasy_tech_web_app=self.webpackChunkeasy_tech_web_app||[]).push([[650],{7650:(e,t,r)=>{"use strict";r.r(t),r.d(t,{AuthModule:()=>G});var n=r(3679),o=r(9517),s=r(8583),a=r(8452),i=r(7716);let l=(()=>{class e{constructor(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ng-component"]],decls:2,vars:0,template:function(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div"),i["\u0275\u0275element"](1,"router-outlet"),i["\u0275\u0275elementEnd"]())},directives:[a.lC],encapsulation:2}),e})();var m=r(1841),d=r(5310),c=r(7188),u=r(1153),p=r(2954);function f(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div"),i["\u0275\u0275text"](1,"Username is required"),i["\u0275\u0275elementEnd"]())}function g(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",17),i["\u0275\u0275template"](1,f,2,0,"div",18),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",e.f.username.errors.required)}}function v(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div"),i["\u0275\u0275text"](1,"Password is required"),i["\u0275\u0275elementEnd"]())}function h(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",17),i["\u0275\u0275template"](1,v,2,0,"div",18),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",e.f.password.errors.required)}}function b(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",5),i["\u0275\u0275elementStart"](1,"label",19),i["\u0275\u0275text"](2,"OTP"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275element"](3,"input",20),i["\u0275\u0275elementEnd"]())}function S(e,t){1&e&&i["\u0275\u0275element"](0,"span",21)}function w(e,t){1&e&&i["\u0275\u0275element"](0,"span",21)}function P(e,t){if(1&e){const e=i["\u0275\u0275getCurrentView"]();i["\u0275\u0275elementStart"](0,"a",22),i["\u0275\u0275listener"]("click",function(){return i["\u0275\u0275restoreView"](e),i["\u0275\u0275nextContext"]().onSubmit()}),i["\u0275\u0275template"](1,w,1,0,"span",13),i["\u0275\u0275text"](2," Validate OTP "),i["\u0275\u0275elementEnd"]()}if(2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",e.loading)}}function C(e,t){1&e&&i["\u0275\u0275element"](0,"span",21)}const y=function(e){return{"is-invalid":e}};let I=(()=>{class e{constructor(e,t,r,n,o,s){this.formBuilder=e,this.route=t,this.router=r,this._authService=n,this._snackBar=o,this._mixPanel=s,this.loading=!1,this.submitted=!1,this.showOtpControl=!1}ngOnInit(){this.loginForm=this.formBuilder.group({username:["",n.kI.required],password:["",n.kI.required],OTP:[""]})}get f(){return this.loginForm.controls}onRequestOtp(){if(this.submitted=!0,this.loginForm.invalid)return;let e={};e.Username=this.f.username.value,e.Password=this.f.password.value,this._authService.requestOTP(e).subscribe(e=>{e.type===m.dt.Sent&&(this.loading=!0),e.type===m.dt.Response&&(this.showOtpControl=!0,this.loading=!1,this.openSnackBar("OTP sent to your cell number","Info"),this._mixPanel.track("Request 2FA OTP"))},e=>{this.loading=!1,this._openErrorMessageSnackBar(e.error.message)})}onSubmit(){this.submitted=!0;let e=!0;if(""==this.f.username.value&&(this.openSnackBar("Username is required","Error"),e=!1),""==this.f.OTP.value&&(this.openSnackBar("OTP is required","Error"),e=!1),e){let e={};e.Username=this.f.username.value,e.OTP=this.f.OTP.value,this._authService.validateOTP(e).subscribe(e=>{e.type===m.dt.Sent&&(this.loading=!0),e.type===m.dt.Response&&(this.loading=!1,localStorage.setItem("token",e.body.token),this._mixPanel.track("Log In"),this._authService.isSignedIn()&&(this._authService.currentUser.UserRole.toLowerCase()=="Parent".toLowerCase()&&this.openSnackBar("Cannot log in to admin dashboard with parent account","Error"),this._authService.currentUser.UserRole.toLowerCase()=="Employee".toLowerCase()||this._authService.currentUser.UserRole.toLowerCase()=="administrator".toLowerCase()))&&this.router.navigateByUrl(this.route.snapshot.queryParams.returnUrl||"/")},e=>{this.loading=!1,this._openErrorMessageSnackBar(e.error.message)})}}onNavigateToRegister(){this.router.navigate(["auth","register"])}openSnackBar(e,t){this._snackBar.open(e,t,{duration:3e3})}_openErrorMessageSnackBar(e){const t=this._snackBar.openFromComponent(d.o,{data:{preClose:()=>{t.dismiss()},parent:e}})}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](n.qu),i["\u0275\u0275directiveInject"](a.gz),i["\u0275\u0275directiveInject"](a.F0),i["\u0275\u0275directiveInject"](c.e),i["\u0275\u0275directiveInject"](u.ux),i["\u0275\u0275directiveInject"](p.h))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ng-component"]],decls:28,vars:13,consts:[[1,"row"],["id","img",1,"col-6",2,"text-align","center","margin-top","50px"],["src","/assets/logo.png","width","360","height","340","alt","Hatfield Montessori Logo"],[1,"col-6"],[2,"width","50%","margin-top","50px",3,"formGroup"],[1,"form-group"],["for","username"],["type","text","formControlName","username","placeholder","Your email","required","",1,"form-control",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["for","password"],["type","password","formControlName","password","required","",1,"form-control",3,"ngClass"],["class","form-group",4,"ngIf"],[1,"btn","btn-primary",3,"click"],["class","spinner-border spinner-border-sm mr-1",4,"ngIf"],["class","validate-otp btn btn-primary ",3,"click",4,"ngIf"],[1,"validate-otp","btn","btn-secondary",3,"click"],[1,"btn","btn-link",3,"click"],[1,"invalid-feedback"],[4,"ngIf"],["for","otpCode"],["type","text","formControlName","OTP",1,"form-control"],[1,"spinner-border","spinner-border-sm","mr-1"],[1,"validate-otp","btn","btn-primary",3,"click"]],template:function(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",0),i["\u0275\u0275elementStart"](1,"div",1),i["\u0275\u0275element"](2,"img",2),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementStart"](3,"div",3),i["\u0275\u0275elementStart"](4,"form",4),i["\u0275\u0275elementStart"](5,"h2"),i["\u0275\u0275text"](6,"Login"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementStart"](7,"div",5),i["\u0275\u0275elementStart"](8,"label",6),i["\u0275\u0275text"](9,"Username"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275element"](10,"input",7),i["\u0275\u0275template"](11,g,2,1,"div",8),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementStart"](12,"div",5),i["\u0275\u0275elementStart"](13,"label",9),i["\u0275\u0275text"](14,"Password"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275element"](15,"input",10),i["\u0275\u0275template"](16,h,2,1,"div",8),i["\u0275\u0275elementEnd"](),i["\u0275\u0275template"](17,b,4,0,"div",11),i["\u0275\u0275elementStart"](18,"div",5),i["\u0275\u0275elementStart"](19,"a",12),i["\u0275\u0275listener"]("click",function(){return t.onRequestOtp()}),i["\u0275\u0275template"](20,S,1,0,"span",13),i["\u0275\u0275text"](21," Request OTP "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275template"](22,P,3,1,"a",14),i["\u0275\u0275elementStart"](23,"a",15),i["\u0275\u0275listener"]("click",function(){return t.onNavigateToRegister()}),i["\u0275\u0275template"](24,C,1,0,"span",13),i["\u0275\u0275text"](25," Register "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementStart"](26,"a",16),i["\u0275\u0275listener"]("click",function(){return t.onNavigateToRegister()}),i["\u0275\u0275text"](27,"Forgot Password"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"]()),2&e&&(i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("formGroup",t.loginForm),i["\u0275\u0275advance"](6),i["\u0275\u0275property"]("ngClass",i["\u0275\u0275pureFunction1"](9,y,t.submitted&&t.f.username.errors)),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",t.submitted&&t.f.username.errors),i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("ngClass",i["\u0275\u0275pureFunction1"](11,y,t.submitted&&t.f.password.errors)),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",t.submitted&&t.f.password.errors),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",t.showOtpControl),i["\u0275\u0275advance"](3),i["\u0275\u0275property"]("ngIf",t.loading),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",t.showOtpControl),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("ngIf",t.loading))},directives:[n._Y,n.JL,n.sg,n.Fj,n.JJ,n.u,n.Q7,s.mk,s.O5],styles:["#img[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{display:block;margin:auto}.btn-primary[_ngcontent-%COMP%]{margin-left:.5rem;margin-right:.5rem}"]}),e})();var E=r(5970);function k(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div"),i["\u0275\u0275text"](1,"Email is required"),i["\u0275\u0275elementEnd"]())}function x(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div"),i["\u0275\u0275text"](1,"Invalid email"),i["\u0275\u0275elementEnd"]())}function U(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",18),i["\u0275\u0275template"](1,k,2,0,"div",19),i["\u0275\u0275template"](2,x,2,0,"div",19),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",null==e.f.UserName.errors?null:e.f.UserName.errors.required),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",null==e.f.UserName.errors?null:e.f.UserName.errors.email)}}function N(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div"),i["\u0275\u0275text"](1,"Phone number is required"),i["\u0275\u0275elementEnd"]())}function _(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div"),i["\u0275\u0275text"](1,"Invalid format. Number should start with +27 and have 9 digits(without the 0) after +27"),i["\u0275\u0275elementEnd"]())}function q(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",18),i["\u0275\u0275template"](1,N,2,0,"div",19),i["\u0275\u0275template"](2,_,2,0,"div",19),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",null==e.f.PhoneNumber.errors?null:e.f.PhoneNumber.errors.required),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",null==e.f.PhoneNumber.errors?null:e.f.PhoneNumber.errors.pattern)}}function B(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div"),i["\u0275\u0275text"](1,"Password is required"),i["\u0275\u0275elementEnd"]())}function O(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div"),i["\u0275\u0275text"](1,"Password must be at least 6 characters"),i["\u0275\u0275elementEnd"]())}function F(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",18),i["\u0275\u0275template"](1,B,2,0,"div",19),i["\u0275\u0275template"](2,O,2,0,"div",19),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",null==e.f.UserPassword.errors?null:e.f.UserPassword.errors.required),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",null==e.f.UserPassword.errors?null:e.f.UserPassword.errors.minlength)}}function j(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div"),i["\u0275\u0275text"](1,"Password is required"),i["\u0275\u0275elementEnd"]())}function R(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div"),i["\u0275\u0275text"](1,"Password must be at least 6 characters"),i["\u0275\u0275elementEnd"]())}function T(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div"),i["\u0275\u0275text"](1,"Password and Confirm Password must be the same "),i["\u0275\u0275elementEnd"]())}function L(e,t){if(1&e&&(i["\u0275\u0275elementStart"](0,"div",18),i["\u0275\u0275template"](1,j,2,0,"div",19),i["\u0275\u0275template"](2,R,2,0,"div",19),i["\u0275\u0275template"](3,T,2,0,"div",19),i["\u0275\u0275elementEnd"]()),2&e){const e=i["\u0275\u0275nextContext"]();i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",null==e.f.UserPasswordConfirm.errors?null:e.f.UserPasswordConfirm.errors.required),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",null==e.f.UserPasswordConfirm.errors?null:e.f.UserPasswordConfirm.errors.minlength),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",e.f.UserPasswordConfirm.errors.confirmedValidator)}}function M(e,t){1&e&&i["\u0275\u0275element"](0,"span",20)}const J=function(e){return{"is-invalid":e}},V=[{path:"",component:l,children:[{path:"login",component:I},{path:"register",component:(()=>{class e{constructor(e,t,r,o,s,a,i){this.formBuilder=e,this.alertService=t,this.datepipe=r,this._authService=o,this._activatedRoute=s,this._router=a,this._matSnackBar=i,this.User=new n.NI,this.loading=!1,this.submitted=!1,this.listUserRoles=[],this.formSubmitted=!1,this.theErrors=[]}selectInput(e){this.isNameSelected="1"==e.target.value}ngOnInit(){this.buildForm()}get f(){return this.registerForm.controls}onSubmit(e){if(this.submitted=!0,this.alertService.clear(),this.registerForm.invalid)return;this.timestamp=new Date,this.loading=!0;let t={};t.UserName=this.f.UserName.value,t.UserPassword=this.f.UserPassword.value,t.PhoneNumber=this.f.PhoneNumber.value,this._authService.register(t).subscribe({next:e=>{e.type==m.dt.Response&&(this.loading=!1,this._openErrorMessageSnackBar("Registration Successful. Contact the admin to create an employee profile for you"),this._router.navigate(["auth","login"]))},error:e=>{this.loading=!1,this._openErrorMessageSnackBar(e.error.message)},complete:()=>{}})}openSnackBar(e,t){this._matSnackBar.open(e,t,{duration:3e3})}_openErrorMessageSnackBar(e){const t=this._matSnackBar.openFromComponent(d.o,{data:{preClose:()=>{t.dismiss()},parent:e}})}buildForm(){this.registerForm=this.formBuilder.group({UserName:["",[n.kI.required,n.kI.email]],PhoneNumber:["",[n.kI.required,n.kI.pattern("^((\\+27-?))?[0-9]{9}$")]],UserPassword:["",[n.kI.required,n.kI.minLength(6)]],UserPasswordConfirm:["",n.kI.required]},{validator:e=>{const t=e.controls.UserPasswordConfirm;t.errors&&!t.errors.confirmedValidator||t.setErrors(e.controls.UserPassword.value!==t.value?{confirmedValidator:!0}:null)}})}}return e.\u0275fac=function(t){return new(t||e)(i["\u0275\u0275directiveInject"](n.qu),i["\u0275\u0275directiveInject"](E.c),i["\u0275\u0275directiveInject"](s.uU),i["\u0275\u0275directiveInject"](c.e),i["\u0275\u0275directiveInject"](a.gz),i["\u0275\u0275directiveInject"](a.F0),i["\u0275\u0275directiveInject"](u.ux))},e.\u0275cmp=i["\u0275\u0275defineComponent"]({type:e,selectors:[["ng-component"]],decls:33,vars:19,consts:[[1,"row"],["id","img",1,"col-6",2,"text-align","center","margin-top","50px"],["src","/assets/logo.png","width","360","height","340","alt","Hatfield Montessori Logo"],[1,"col-6"],[3,"formGroup"],[1,"form-group"],["for","UserName"],["type","email","formControlName","UserName","placeholder","E-mail","autocomplete","off",1,"form-control",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["for","PhoneNumber"],["type","text","formControlName","PhoneNumber","placeholder","+27638487949","autocomplete","off",1,"form-control",3,"ngClass"],["for","UserPassword"],["type","password","formControlName","UserPassword",1,"form-control",3,"ngClass"],["for","UserPasswordConfirm"],["type","password","formControlName","UserPasswordConfirm",1,"form-control",3,"ngClass"],[1,"btn","btn-primary",3,"disabled","click"],["class","spinner-border spinner-border-sm mr-1",4,"ngIf"],["routerLink","../login",1,"btn","btn-link"],[1,"invalid-feedback"],[4,"ngIf"],[1,"spinner-border","spinner-border-sm","mr-1"]],template:function(e,t){1&e&&(i["\u0275\u0275elementStart"](0,"div",0),i["\u0275\u0275elementStart"](1,"div",1),i["\u0275\u0275element"](2,"img",2),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementStart"](3,"div",3),i["\u0275\u0275elementStart"](4,"form",4),i["\u0275\u0275elementStart"](5,"h2"),i["\u0275\u0275text"](6,"Register"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementStart"](7,"div",5),i["\u0275\u0275elementStart"](8,"label",6),i["\u0275\u0275text"](9,"Username"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275element"](10,"input",7),i["\u0275\u0275template"](11,U,3,2,"div",8),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementStart"](12,"div",5),i["\u0275\u0275elementStart"](13,"label",9),i["\u0275\u0275text"](14,"Phone Number"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275element"](15,"input",10),i["\u0275\u0275template"](16,q,3,2,"div",8),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementStart"](17,"div",5),i["\u0275\u0275elementStart"](18,"label",11),i["\u0275\u0275text"](19,"Password"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275element"](20,"input",12),i["\u0275\u0275template"](21,F,3,2,"div",8),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementStart"](22,"div",5),i["\u0275\u0275elementStart"](23,"label",13),i["\u0275\u0275text"](24,"Password Confirm"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275element"](25,"input",14),i["\u0275\u0275template"](26,L,4,3,"div",8),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementStart"](27,"div",5),i["\u0275\u0275elementStart"](28,"button",15),i["\u0275\u0275listener"]("click",function(e){return t.onSubmit(e)}),i["\u0275\u0275template"](29,M,1,0,"span",16),i["\u0275\u0275text"](30," Register "),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementStart"](31,"a",17),i["\u0275\u0275text"](32,"Back"),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"](),i["\u0275\u0275elementEnd"]()),2&e&&(i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("formGroup",t.registerForm),i["\u0275\u0275advance"](6),i["\u0275\u0275property"]("ngClass",i["\u0275\u0275pureFunction1"](11,J,t.submitted&&t.f.UserName.errors)),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",t.submitted&&t.f.UserName.errors),i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("ngClass",i["\u0275\u0275pureFunction1"](13,J,t.submitted&&t.f.PhoneNumber.errors)),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",t.submitted&&t.f.PhoneNumber.errors),i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("ngClass",i["\u0275\u0275pureFunction1"](15,J,t.submitted&&t.f.UserPassword.errors)),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",t.submitted&&t.f.UserPassword.errors),i["\u0275\u0275advance"](4),i["\u0275\u0275property"]("ngClass",i["\u0275\u0275pureFunction1"](17,J,t.submitted&&t.f.UserPasswordConfirm.errors)),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",t.submitted&&t.f.UserPasswordConfirm.errors),i["\u0275\u0275advance"](2),i["\u0275\u0275property"]("disabled",t.loading),i["\u0275\u0275advance"](1),i["\u0275\u0275property"]("ngIf",t.loading))},directives:[n._Y,n.JL,n.sg,n.Fj,n.JJ,n.u,s.mk,s.O5,a.yS],encapsulation:2}),e})()}]}];let z=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=i["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=i["\u0275\u0275defineInjector"]({imports:[[a.Bz.forChild(V)],a.Bz]}),e})(),G=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=i["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=i["\u0275\u0275defineInjector"]({imports:[[s.ez,n.UX,z,n.u5,o.IJ]]}),e})()}}]);